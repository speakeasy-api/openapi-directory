/*
 * Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT.
 */

import * as utils from "../internal/utils";
import * as operations from "./models/operations";
import * as shared from "./models/shared";
import { AxiosInstance, AxiosRequestConfig, AxiosResponse } from "axios";

export class ComputerVision {
  _defaultClient: AxiosInstance;
  _securityClient: AxiosInstance;
  _serverURL: string;
  _language: string;
  _sdkVersion: string;
  _genVersion: string;

  constructor(
    defaultClient: AxiosInstance,
    securityClient: AxiosInstance,
    serverURL: string,
    language: string,
    sdkVersion: string,
    genVersion: string
  ) {
    this._defaultClient = defaultClient;
    this._securityClient = securityClient;
    this._serverURL = serverURL;
    this._language = language;
    this._sdkVersion = sdkVersion;
    this._genVersion = genVersion;
  }

  /**
   * List suggested keywords
   *
   * @remarks
   * This endpoint returns a list of suggested keywords for a media item that you specify or upload.
   */
  getKeywords(
    req: operations.GetKeywordsRequest,
    security: operations.GetKeywordsSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetKeywordsResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.GetKeywordsRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = baseURL.replace(/\/$/, "") + "/v2/cv/keywords";
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.GetKeywordsSecurity(security);
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const queryParams: string = utils.serializeQueryParams(req);

    const r = client.request({
      url: url + queryParams,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetKeywordsResponse =
        new operations.GetKeywordsResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.keywordDataList = utils.objectToClass(
              httpRes?.data,
              shared.KeywordDataList
            );
          }
          break;
        case [400, 401, 403, 415].includes(httpRes?.status):
          break;
      }

      return res;
    });
  }

  /**
   * List similar images
   *
   * @remarks
   * This endpoint returns images that are visually similar to an image that you specify or upload.
   */
  getSimilarImages(
    req: operations.GetSimilarImagesRequest,
    security: operations.GetSimilarImagesSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetSimilarImagesResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.GetSimilarImagesRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = baseURL.replace(/\/$/, "") + "/v2/cv/similar/images";
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.GetSimilarImagesSecurity(security);
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const queryParams: string = utils.serializeQueryParams(req);

    const r = client.request({
      url: url + queryParams,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetSimilarImagesResponse =
        new operations.GetSimilarImagesResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.imageSearchResults = utils.objectToClass(
              httpRes?.data,
              shared.ImageSearchResults
            );
          }
          break;
        case [400, 401, 403].includes(httpRes?.status):
          break;
      }

      return res;
    });
  }

  /**
   * List similar videos
   *
   * @remarks
   * This endpoint returns videos that are visually similar to an image that you specify or upload.
   */
  getSimilarVideos(
    req: operations.GetSimilarVideosRequest,
    security: operations.GetSimilarVideosSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetSimilarVideosResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.GetSimilarVideosRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = baseURL.replace(/\/$/, "") + "/v2/cv/similar/videos";
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.GetSimilarVideosSecurity(security);
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const queryParams: string = utils.serializeQueryParams(req);

    const r = client.request({
      url: url + queryParams,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetSimilarVideosResponse =
        new operations.GetSimilarVideosResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.videoSearchResults = utils.objectToClass(
              httpRes?.data,
              shared.VideoSearchResults
            );
          }
          break;
        case [400, 401, 403].includes(httpRes?.status):
          break;
      }

      return res;
    });
  }

  /**
   * Upload ephemeral images
   *
   * @remarks
   * Deprecated; use `POST /v2/cv/images` instead. This endpoint uploads an image for reverse image search. The image must be in JPEG or PNG format. To get the search results, pass the ID that this endpoint returns to the `GET /v2/images/{id}/similar` endpoint.
   */
  uploadEphemeralImage(
    req: shared.ImageCreateRequest,
    security: operations.UploadEphemeralImageSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.UploadEphemeralImageResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new shared.ImageCreateRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = baseURL.replace(/\/$/, "") + "/v2/images";

    let [reqBodyHeaders, reqBody]: [object, any] = [{}, {}];

    try {
      [reqBodyHeaders, reqBody] = utils.serializeRequestBody(
        req,
        "request",
        "json"
      );
    } catch (e: unknown) {
      if (e instanceof Error) {
        throw new Error(`Error serializing request body, cause: ${e.message}`);
      }
    }
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.UploadEphemeralImageSecurity(security);
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const headers = { ...reqBodyHeaders, ...config?.headers };
    if (reqBody == null || Object.keys(reqBody).length === 0)
      throw new Error("request body is required");

    const r = client.request({
      url: url,
      method: "post",
      headers: headers,
      data: reqBody,
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.UploadEphemeralImageResponse =
        new operations.UploadEphemeralImageResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 201:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.imageCreateResponse = utils.objectToClass(
              httpRes?.data,
              shared.ImageCreateResponse
            );
          }
          break;
        case [400, 401, 403, 413].includes(httpRes?.status):
          break;
      }

      return res;
    });
  }

  /**
   * Upload images
   *
   * @remarks
   * This endpoint uploads an image for reverse image or video search. Images must be in JPEG or PNG format. To get the search results, pass the upload ID that this endpoint returns to the GET /v2/cv/similar/images or GET /v2/cv/similar/videos endpoints. Contact us for access to this endpoint.
   */
  uploadImage(
    req: shared.ImageCreateRequest,
    security: operations.UploadImageSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.UploadImageResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new shared.ImageCreateRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = baseURL.replace(/\/$/, "") + "/v2/cv/images";

    let [reqBodyHeaders, reqBody]: [object, any] = [{}, {}];

    try {
      [reqBodyHeaders, reqBody] = utils.serializeRequestBody(
        req,
        "request",
        "json"
      );
    } catch (e: unknown) {
      if (e instanceof Error) {
        throw new Error(`Error serializing request body, cause: ${e.message}`);
      }
    }
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.UploadImageSecurity(security);
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const headers = { ...reqBodyHeaders, ...config?.headers };
    if (reqBody == null || Object.keys(reqBody).length === 0)
      throw new Error("request body is required");

    const r = client.request({
      url: url,
      method: "post",
      headers: headers,
      data: reqBody,
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.UploadImageResponse =
        new operations.UploadImageResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 201:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.computerVisionImageCreateResponse = utils.objectToClass(
              httpRes?.data,
              shared.ComputerVisionImageCreateResponse
            );
          }
          break;
        case [400, 401, 403, 413, 415].includes(httpRes?.status):
          break;
      }

      return res;
    });
  }
}
