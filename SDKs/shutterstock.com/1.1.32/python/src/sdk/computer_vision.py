"""Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT."""

import requests as requests_http
from . import utils
from sdk.models import operations, shared
from typing import Optional

class ComputerVision:
    _client: requests_http.Session
    _security_client: requests_http.Session
    _server_url: str
    _language: str
    _sdk_version: str
    _gen_version: str

    def __init__(self, client: requests_http.Session, security_client: requests_http.Session, server_url: str, language: str, sdk_version: str, gen_version: str) -> None:
        self._client = client
        self._security_client = security_client
        self._server_url = server_url
        self._language = language
        self._sdk_version = sdk_version
        self._gen_version = gen_version
        
    def get_keywords(self, request: operations.GetKeywordsRequest, security: operations.GetKeywordsSecurity) -> operations.GetKeywordsResponse:
        r"""List suggested keywords
        This endpoint returns a list of suggested keywords for a media item that you specify or upload.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v2/cv/keywords'
        
        query_params = utils.get_query_params(operations.GetKeywordsRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.GetKeywordsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.KeywordDataList])
                res.keyword_data_list = out
        elif http_res.status_code in [400, 401, 403, 415]:
            pass

        return res

    def get_similar_images(self, request: operations.GetSimilarImagesRequest, security: operations.GetSimilarImagesSecurity) -> operations.GetSimilarImagesResponse:
        r"""List similar images
        This endpoint returns images that are visually similar to an image that you specify or upload.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v2/cv/similar/images'
        
        query_params = utils.get_query_params(operations.GetSimilarImagesRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.GetSimilarImagesResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ImageSearchResults])
                res.image_search_results = out
        elif http_res.status_code in [400, 401, 403]:
            pass

        return res

    def get_similar_videos(self, request: operations.GetSimilarVideosRequest, security: operations.GetSimilarVideosSecurity) -> operations.GetSimilarVideosResponse:
        r"""List similar videos
        This endpoint returns videos that are visually similar to an image that you specify or upload.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v2/cv/similar/videos'
        
        query_params = utils.get_query_params(operations.GetSimilarVideosRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.GetSimilarVideosResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.VideoSearchResults])
                res.video_search_results = out
        elif http_res.status_code in [400, 401, 403]:
            pass

        return res

    def upload_ephemeral_image(self, request: shared.ImageCreateRequest, security: operations.UploadEphemeralImageSecurity) -> operations.UploadEphemeralImageResponse:
        r"""Upload ephemeral images
        Deprecated; use `POST /v2/cv/images` instead. This endpoint uploads an image for reverse image search. The image must be in JPEG or PNG format. To get the search results, pass the ID that this endpoint returns to the `GET /v2/images/{id}/similar` endpoint.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v2/images'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.UploadEphemeralImageResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 201:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ImageCreateResponse])
                res.image_create_response = out
        elif http_res.status_code in [400, 401, 403, 413]:
            pass

        return res

    def upload_image(self, request: shared.ImageCreateRequest, security: operations.UploadImageSecurity) -> operations.UploadImageResponse:
        r"""Upload images
        This endpoint uploads an image for reverse image or video search. Images must be in JPEG or PNG format. To get the search results, pass the upload ID that this endpoint returns to the GET /v2/cv/similar/images or GET /v2/cv/similar/videos endpoints. Contact us for access to this endpoint.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v2/cv/images'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.UploadImageResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 201:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ComputerVisionImageCreateResponse])
                res.computer_vision_image_create_response = out
        elif http_res.status_code in [400, 401, 403, 413, 415]:
            pass

        return res

    