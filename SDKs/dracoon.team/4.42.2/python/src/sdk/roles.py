"""Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT."""

import requests as requests_http
from . import utils
from sdk.models import operations, shared
from typing import Optional

class Roles:
    r"""Role user management"""
    _client: requests_http.Session
    _security_client: requests_http.Session
    _server_url: str
    _language: str
    _sdk_version: str
    _gen_version: str

    def __init__(self, client: requests_http.Session, security_client: requests_http.Session, server_url: str, language: str, sdk_version: str, gen_version: str) -> None:
        self._client = client
        self._security_client = security_client
        self._server_url = server_url
        self._language = language
        self._sdk_version = sdk_version
        self._gen_version = gen_version
        
    def add_role_groups(self, request: operations.AddRoleGroupsRequest) -> operations.AddRoleGroupsResponse:
        r"""Assign group(s) to the role
        ### Description:
        Assign group(s) to a role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; grant permission on desired role</span> required.
        
        ### Postcondition:
        One or more groups will be added to a role.
        
        ### Further Information:
        None.
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.AddRoleGroupsRequest, base_url, '/v4/roles/{role_id}/groups', request)
        
        headers = utils.get_headers(request)
        req_content_type, data, form = utils.serialize_request_body(request, "group_ids", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.AddRoleGroupsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleGroupList])
                res.role_group_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def add_role_users(self, request: operations.AddRoleUsersRequest) -> operations.AddRoleUsersResponse:
        r"""Assign user(s) to the role
        ### Description:
        Assign user(s) to a role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; grant permission on desired role</span> required.
        
        ### Postcondition:
        One or more users will be added to a role.
        
        ### Further Information:
        None.
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.AddRoleUsersRequest, base_url, '/v4/roles/{role_id}/users', request)
        
        headers = utils.get_headers(request)
        req_content_type, data, form = utils.serialize_request_body(request, "user_ids", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.AddRoleUsersResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleUserList])
                res.role_user_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 409, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def request_role_groups(self, request: operations.RequestRoleGroupsRequest) -> operations.RequestRoleGroupsResponse:
        r"""Request groups with specific role
        ### Description:  
        Get all groups with a specific role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; read groups</span> required.
        
        ### Postcondition:
        List of to the role assigned groups is returned.
        
        ### Further Information:
        
        ### Filtering:
        All filter fields are connected via logical conjunction (**AND**)  
        Filter string syntax: `FIELD_NAME:OPERATOR:VALUE`  
        
        <details style=\"padding-left: 10px\">
        <summary style=\"cursor: pointer; outline: none\"><strong>Example</strong></summary>
        
        `isMember:eq:false|name:cn:searchString`  
        Get all groups that are **NOT** a member of that role **AND** whose name contains `searchString`.
        
        </details>
        
        ### Filtering options:
        <details style=\"padding: 10px; background-color: #F6F7F8; border: 1px solid #AAA; border-radius: 5px;\">
        <summary style=\"cursor: pointer; outline: none\"><strong>Expand</strong></summary>
        
        | `FIELD_NAME` | Filter Description | `OPERATOR` | Operator Description | `VALUE` |
        | :--- | :--- | :--- | :--- | :--- |
        | `isMember` | Filter the groups which are (not) member of that role | `eq` |  | <ul><li>`true`</li><li>`false`</li><li>`any`</li></ul>default: `true` |
        | `name` | Group name filter | `cn` | Group name contains value. | `search String` |
        
        </details>
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.RequestRoleGroupsRequest, base_url, '/v4/roles/{role_id}/groups', request)
        
        headers = utils.get_headers(request)
        query_params = utils.get_query_params(operations.RequestRoleGroupsRequest, request)
        
        client = self._security_client
        
        http_res = client.request('GET', url, params=query_params, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RequestRoleGroupsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleGroupList])
                res.role_group_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def request_role_users(self, request: operations.RequestRoleUsersRequest) -> operations.RequestRoleUsersResponse:
        r"""Request users with specific role
        ### Description:  
        Get all users with a specific role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; read users</span> required.
        
        ### Postcondition:
        List of users is returned.
        
        ### Further Information:
        
        ### Filtering:
        All filter fields are connected via logical conjunction (**AND**)  
        Filter string syntax: `FIELD_NAME:OPERATOR:VALUE`  
        
        <details style=\"padding-left: 10px\">
        <summary style=\"cursor: pointer; outline: none\"><strong>Example</strong></summary>
        
        `isMember:eq:false|user:cn:searchString`  
        Get all users that are **NOT** member of that role **AND** whose (`firstName` **OR** `lastName` **OR** `email` **OR** `username`) is like `searchString`.
        
        </details>
        
        ### Filtering options:
        <details style=\"padding: 10px; background-color: #F6F7F8; border: 1px solid #AAA; border-radius: 5px;\">
        <summary style=\"cursor: pointer; outline: none\"><strong>Expand</strong></summary>
        
        | `FIELD_NAME` | Filter Description | `OPERATOR` | Operator Description | `VALUE` |
        | :--- | :--- | :--- | :--- | :--- |
        | `user` | User filter | `cn` | User contains value (`firstName` **OR** `lastName` **OR** `email` **OR** `username`). | `search String` |
        | `isMember` | Filter the users which are (not) member of that role | `eq` |  | <ul><li>`true`</li><li>`false`</li><li>`any`</li></ul>default: `true` |
        
        </details>
        
        ### Deprecated filtering options:
        <details style=\"padding: 10px; background-color: #F6F7F8; border: 1px solid #AAA; border-radius: 5px;\">
        <summary style=\"cursor: pointer; outline: none\"><strong>Expand</strong></summary>
        
        | `FIELD_NAME` | Filter Description | `OPERATOR` | Operator Description | `VALUE` |
        | :--- | :--- | :--- | :--- | :--- |
        | <del>`displayName`</del> | User display name filter (use `user` filter) | `cn` | User display name contains value (`firstName` **OR** `lastName` **OR** `email`). | `search String` |
        
        </details>
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.RequestRoleUsersRequest, base_url, '/v4/roles/{role_id}/users', request)
        
        headers = utils.get_headers(request)
        query_params = utils.get_query_params(operations.RequestRoleUsersRequest, request)
        
        client = self._security_client
        
        http_res = client.request('GET', url, params=query_params, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RequestRoleUsersResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleUserList])
                res.role_user_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def request_roles(self, request: operations.RequestRolesRequest) -> operations.RequestRolesResponse:
        r"""Request all roles with assigned rights
        ### Description:  
        Retrieve a list of all roles with assigned rights.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; read users</span> required.
        
        ### Postcondition:
        List of roles with assigned rights is returned.
        
        ### Further Information:
        None.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v4/roles'
        
        headers = utils.get_headers(request)
        
        client = self._security_client
        
        http_res = client.request('GET', url, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RequestRolesResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleList])
                res.role_list = out
        elif http_res.status_code in [401, 403, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def revoke_role_groups(self, request: operations.RevokeRoleGroupsRequest) -> operations.RevokeRoleGroupsResponse:
        r"""Revoke granted role from group(s)
        ### Description:  
        Revoke granted group(s) from a role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; grant permission on desired role</span> required.  
        For each role, at least one non-expiring user **MUST** remain who may grant the role.
        
        ### Postcondition:
        One or more groups will be removed from a role.
        
        ### Further Information:
        None.
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.RevokeRoleGroupsRequest, base_url, '/v4/roles/{role_id}/groups', request)
        
        headers = utils.get_headers(request)
        req_content_type, data, form = utils.serialize_request_body(request, "group_ids", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('DELETE', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RevokeRoleGroupsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleGroupList])
                res.role_group_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    def revoke_role_users(self, request: operations.RevokeRoleUsersRequest) -> operations.RevokeRoleUsersResponse:
        r"""Revoke granted role from user(s)
        ### Description:  
        Revoke granted user(s) from a role.
        
        ### Precondition:
        Right <span style='padding: 3px; background-color: #F6F7F8; border: 1px solid #000; border-radius: 5px; display: inline;'>&#128275; grant permission on desired role</span> required.  
        For each role, at least one non-expiring user **MUST** remain who may grant the role.
        
        ### Postcondition:
        One or more users will be removed from a role.
        
        ### Further Information:
        None.
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.RevokeRoleUsersRequest, base_url, '/v4/roles/{role_id}/users', request)
        
        headers = utils.get_headers(request)
        req_content_type, data, form = utils.serialize_request_body(request, "user_ids", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('DELETE', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RevokeRoleUsersResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.RoleUserList])
                res.role_user_list = out
        elif http_res.status_code in [400, 401, 403, 404, 406, 412]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponse])
                res.error_response = out

        return res

    