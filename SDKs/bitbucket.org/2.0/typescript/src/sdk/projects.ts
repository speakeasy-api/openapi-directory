/*
 * Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT.
 */

import * as utils from "../internal/utils";
import * as operations from "./models/operations";
import * as shared from "./models/shared";
import { AxiosInstance, AxiosRequestConfig, AxiosResponse } from "axios";

/**
 * Bitbucket Cloud projects make it easier for teams to focus on
 *
 * @remarks
 * a goal, product, or process by organizing their repositories.
 *
 */
export class Projects {
  _defaultClient: AxiosInstance;
  _securityClient: AxiosInstance;
  _serverURL: string;
  _language: string;
  _sdkVersion: string;
  _genVersion: string;

  constructor(
    defaultClient: AxiosInstance,
    securityClient: AxiosInstance,
    serverURL: string,
    language: string,
    sdkVersion: string,
    genVersion: string
  ) {
    this._defaultClient = defaultClient;
    this._securityClient = securityClient;
    this._serverURL = serverURL;
    this._language = language;
    this._sdkVersion = sdkVersion;
    this._genVersion = genVersion;
  }

  /**
   * Delete a project for a workspace
   *
   * @remarks
   * Deletes this project. This is an irreversible operation.
   *
   * You cannot delete a project that still contains repositories.
   * To delete the project, [delete](/cloud/bitbucket/rest/api-group-repositories/#api-repositories-workspace-repo-slug-delete)
   * or transfer the repositories first.
   *
   * Example:
   * ```
   * $ curl -X DELETE https://api.bitbucket.org/2.0/bbworkspace1/PROJ
   * ```
   */
  deleteWorkspacesWorkspaceProjectsProjectKey(
    req: operations.DeleteWorkspacesWorkspaceProjectsProjectKeyRequest,
    security: operations.DeleteWorkspacesWorkspaceProjectsProjectKeySecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.DeleteWorkspacesWorkspaceProjectsProjectKeyResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.DeleteWorkspacesWorkspaceProjectsProjectKeyRequest(
        req
      );
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.DeleteWorkspacesWorkspaceProjectsProjectKeySecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "delete",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.DeleteWorkspacesWorkspaceProjectsProjectKeyResponse =
        new operations.DeleteWorkspacesWorkspaceProjectsProjectKeyResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 204:
          break;
        case [403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Remove the specific user from the project's default reviewers
   *
   * @remarks
   * Removes a default reviewer from the project.
   *
   * Example:
   * ```
   * $ curl https://api.bitbucket.org/2.0/.../default-reviewers/%7Bf0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6%7D
   *
   * HTTP/1.1 204
   * ```
   */
  deleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUser(
    req: operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest,
    security: operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req =
        new operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest(
          req
        );
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}/default-reviewers/{selected_user}",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "delete",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse =
        new operations.DeleteWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse(
          {
            statusCode: httpRes.status,
            contentType: contentType,
            rawResponse: httpRes,
          }
        );
      switch (true) {
        case httpRes?.status == 204:
          break;
        case [400, 403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Get a project for a workspace
   *
   * @remarks
   * Returns the requested project.
   */
  getWorkspacesWorkspaceProjectsProjectKey(
    req: operations.GetWorkspacesWorkspaceProjectsProjectKeyRequest,
    security: operations.GetWorkspacesWorkspaceProjectsProjectKeySecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetWorkspacesWorkspaceProjectsProjectKeyResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.GetWorkspacesWorkspaceProjectsProjectKeyRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeySecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetWorkspacesWorkspaceProjectsProjectKeyResponse =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
        });
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.project = utils.objectToClass(httpRes?.data);
          }
          break;
        case [401, 403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * List the default reviewers in a project
   *
   * @remarks
   * Return a list of all default reviewers for a project. This is a list of users that will be added as default
   * reviewers to pull requests for any repository within the project.
   *
   * Example:
   * ```
   * $ curl https://api.bitbucket.org/2.0/.../projects/.../default-reviewers | jq .
   * {
   *     "pagelen": 10,
   *     "values": [
   *         {
   *             "user": {
   *                 "display_name": "Davis Lee",
   *                 "uuid": "{f0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6}"
   *             },
   *             "reviewer_type": "project",
   *             "type": "default_reviewer"
   *         },
   *         {
   *             "user": {
   *                 "display_name": "Jorge Rodriguez",
   *                 "uuid": "{1aa43376-260d-4a0b-9660-f62672b9655d}"
   *             },
   *             "reviewer_type": "project",
   *             "type": "default_reviewer"
   *         }
   *     ],
   *     "page": 1,
   *     "size": 2
   * }
   * ```
   */
  getWorkspacesWorkspaceProjectsProjectKeyDefaultReviewers(
    req: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersRequest,
    security: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersRequest(
          req
        );
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}/default-reviewers",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersResponse =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersResponse(
          {
            statusCode: httpRes.status,
            contentType: contentType,
            rawResponse: httpRes,
          }
        );
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.paginatedDefaultReviewerAndType = utils.objectToClass(
              httpRes?.data,
              shared.PaginatedDefaultReviewerAndType
            );
          }
          break;
        case [403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Get a default reviewer
   *
   * @remarks
   * Returns the specified default reviewer.
   *
   * Example:
   * ```
   * $ curl https://api.bitbucket.org/2.0/.../default-reviewers/%7Bf0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6%7D
   * {
   *     "display_name": "Davis Lee",
   *     "type": "user",
   *     "uuid": "{f0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6}"
   * }
   * ```
   */
  getWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUser(
    req: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest,
    security: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest(
          req
        );
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}/default-reviewers/{selected_user}",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "get",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse =
        new operations.GetWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse(
          {
            statusCode: httpRes.status,
            contentType: contentType,
            rawResponse: httpRes,
          }
        );
      switch (true) {
        case httpRes?.status == 200:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.user = utils.objectToClass(httpRes?.data);
          }
          break;
        case [400, 403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Create a project in a workspace
   *
   * @remarks
   * Creates a new project.
   *
   * Note that the avatar has to be embedded as either a data-url
   * or a URL to an external image as shown in the examples below:
   *
   * ```
   * $ body=$(cat << EOF
   * {
   *     "name": "Mars Project",
   *     "key": "MARS",
   *     "description": "Software for colonizing mars.",
   *     "links": {
   *         "avatar": {
   *             "href": "data:image/gif;base64,R0lGODlhEAAQAMQAAORHHOVSKudfOulrSOp3WOyDZu6QdvCchPGolfO0o/..."
   *         }
   *     },
   *     "is_private": false
   * }
   * EOF
   * )
   * $ curl -H "Content-Type: application/json" \
   *        -X POST \
   *        -d "$body" \
   *        https://api.bitbucket.org/2.0/teams/teams-in-space/projects/ | jq .
   * {
   *   // Serialized project document
   * }
   * ```
   *
   * or even:
   *
   * ```
   * $ body=$(cat << EOF
   * {
   *     "name": "Mars Project",
   *     "key": "MARS",
   *     "description": "Software for colonizing mars.",
   *     "links": {
   *         "avatar": {
   *             "href": "http://i.imgur.com/72tRx4w.gif"
   *         }
   *     },
   *     "is_private": false
   * }
   * EOF
   * )
   * $ curl -H "Content-Type: application/json" \
   *        -X POST \
   *        -d "$body" \
   *        https://api.bitbucket.org/2.0/teams/teams-in-space/projects/ | jq .
   * {
   *   // Serialized project document
   * }
   * ```
   */
  postWorkspacesWorkspaceProjects(
    req: operations.PostWorkspacesWorkspaceProjectsRequest,
    security: operations.PostWorkspacesWorkspaceProjectsSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.PostWorkspacesWorkspaceProjectsResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.PostWorkspacesWorkspaceProjectsRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects",
      req
    );

    let [reqBodyHeaders, reqBody]: [object, any] = [{}, {}];

    try {
      [reqBodyHeaders, reqBody] = utils.serializeRequestBody(
        req,
        "requestBody",
        "json"
      );
    } catch (e: unknown) {
      if (e instanceof Error) {
        throw new Error(`Error serializing request body, cause: ${e.message}`);
      }
    }
    if (!(security instanceof utils.SpeakeasyBase)) {
      security = new operations.PostWorkspacesWorkspaceProjectsSecurity(
        security
      );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const headers = { ...reqBodyHeaders, ...config?.headers };
    if (reqBody == null || Object.keys(reqBody).length === 0)
      throw new Error("request body is required");

    const r = client.request({
      url: url,
      method: "post",
      headers: headers,
      data: reqBody,
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.PostWorkspacesWorkspaceProjectsResponse =
        new operations.PostWorkspacesWorkspaceProjectsResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
          headers: utils.getHeadersFromResponse(httpRes.headers),
        });
      switch (true) {
        case httpRes?.status == 201:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.project = utils.objectToClass(httpRes?.data);
          }
          break;
        case [403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Update a project for a workspace
   *
   * @remarks
   * Since this endpoint can be used to both update and to create a
   * project, the request body depends on the intent.
   *
   * #### Creation
   *
   * See the POST documentation for the project collection for an
   * example of the request body.
   *
   * Note: The `key` should not be specified in the body of request
   * (since it is already present in the URL). The `name` is required,
   * everything else is optional.
   *
   * #### Update
   *
   * See the POST documentation for the project collection for an
   * example of the request body.
   *
   * Note: The key is not required in the body (since it is already in
   * the URL). The key may be specified in the body, if the intent is
   * to change the key itself. In such a scenario, the location of the
   * project is changed and is returned in the `Location` header of the
   * response.
   */
  putWorkspacesWorkspaceProjectsProjectKey(
    req: operations.PutWorkspacesWorkspaceProjectsProjectKeyRequest,
    security: operations.PutWorkspacesWorkspaceProjectsProjectKeySecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.PutWorkspacesWorkspaceProjectsProjectKeyResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req = new operations.PutWorkspacesWorkspaceProjectsProjectKeyRequest(req);
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}",
      req
    );

    let [reqBodyHeaders, reqBody]: [object, any] = [{}, {}];

    try {
      [reqBodyHeaders, reqBody] = utils.serializeRequestBody(
        req,
        "requestBody",
        "json"
      );
    } catch (e: unknown) {
      if (e instanceof Error) {
        throw new Error(`Error serializing request body, cause: ${e.message}`);
      }
    }
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.PutWorkspacesWorkspaceProjectsProjectKeySecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const headers = { ...reqBodyHeaders, ...config?.headers };
    if (reqBody == null || Object.keys(reqBody).length === 0)
      throw new Error("request body is required");

    const r = client.request({
      url: url,
      method: "put",
      headers: headers,
      data: reqBody,
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.PutWorkspacesWorkspaceProjectsProjectKeyResponse =
        new operations.PutWorkspacesWorkspaceProjectsProjectKeyResponse({
          statusCode: httpRes.status,
          contentType: contentType,
          rawResponse: httpRes,
          headers: utils.getHeadersFromResponse(httpRes.headers),
        });
      switch (true) {
        case [200, 201].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.project = utils.objectToClass(httpRes?.data);
          }
          break;
        case [403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }

  /**
   * Add the specific user as a default reviewer for the project
   *
   * @remarks
   * Adds the specified user to the project's list of default reviewers. The method is
   * idempotent. Accepts an optional body containing the `uuid` of the user to be added.
   *
   * Example:
   * ```
   * $ curl -XPUT https://api.bitbucket.org/2.0/.../default-reviewers/%7Bf0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6%7D
   * -d { 'uuid': '{f0e0e8e9-66c1-4b85-a784-44a9eb9ef1a6}' }
   *
   * HTTP/1.1 204
   * ```
   */
  putWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUser(
    req: operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest,
    security: operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity,
    config?: AxiosRequestConfig
  ): Promise<operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse> {
    if (!(req instanceof utils.SpeakeasyBase)) {
      req =
        new operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserRequest(
          req
        );
    }

    const baseURL: string = this._serverURL;
    const url: string = utils.generateURL(
      baseURL,
      "/workspaces/{workspace}/projects/{project_key}/default-reviewers/{selected_user}",
      req
    );
    if (!(security instanceof utils.SpeakeasyBase)) {
      security =
        new operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserSecurity(
          security
        );
    }
    const client: AxiosInstance = utils.createSecurityClient(
      this._defaultClient,
      security
    );

    const r = client.request({
      url: url,
      method: "put",
      ...config,
    });

    return r.then((httpRes: AxiosResponse) => {
      const contentType: string = httpRes?.headers?.["content-type"] ?? "";

      if (httpRes?.status == null)
        throw new Error(`status code not found in response: ${httpRes}`);
      const res: operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse =
        new operations.PutWorkspacesWorkspaceProjectsProjectKeyDefaultReviewersSelectedUserResponse(
          {
            statusCode: httpRes.status,
            contentType: contentType,
            rawResponse: httpRes,
          }
        );
      switch (true) {
        case httpRes?.status == 204:
          if (utils.matchContentType(contentType, `application/json`)) {
            res.user = utils.objectToClass(httpRes?.data);
          }
          break;
        case [400, 403, 404].includes(httpRes?.status):
          if (utils.matchContentType(contentType, `application/json`)) {
            res.error = utils.objectToClass(httpRes?.data);
          }
          break;
      }

      return res;
    });
  }
}
