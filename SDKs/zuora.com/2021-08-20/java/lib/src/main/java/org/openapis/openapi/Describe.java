/* 
 * Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT.
 */

package org.openapis.openapi;

import java.net.http.HttpResponse;
import java.nio.charset.StandardCharsets;
import java.util.function.Function;
import java.util.stream.Collectors;
import org.openapis.openapi.utils.HTTPClient;
import org.openapis.openapi.utils.HTTPRequest;

public class Describe {
	
	private HTTPClient _defaultClient;
	private HTTPClient _securityClient;
	private String _serverUrl;
	private String _language;
	private String _sdkVersion;
	private String _genVersion;

	public Describe(HTTPClient defaultClient, HTTPClient securityClient, String serverUrl, String language, String sdkVersion, String genVersion) {
		this._defaultClient = defaultClient;
		this._securityClient = securityClient;
		this._serverUrl = serverUrl;
		this._language = language;
		this._sdkVersion = sdkVersion;
		this._genVersion = genVersion;
	}

    /**
     * Describe an object
     * Provides a reference listing of each object that is available in your Zuora tenant.
     * 
     * The information returned by this call is useful if you are using [CRUD: Create Export](https://www.zuora.com/developer/api-reference/#operation/Object_POSTExport) or the [AQuA API](https://knowledgecenter.zuora.com/DC_Developers/T_Aggregate_Query_API) to create a data source export. See [Export ZOQL](https://knowledgecenter.zuora.com/DC_Developers/M_Export_ZOQL) for more information.
     * 
     * ## Response
     * The response contains an XML document that lists the fields of the specified object. Each of the object's fields is represented by a `&lt;field&gt;` element in the XML document.
     *     
     * Each `&lt;field&gt;` element contains the following elements:
     * 
     * | Element      | Description                                                                                                                                                                                                                                                                                  |
     * |--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     * | `&lt;name&gt;`     | API name of the field.                                                                                                                                                                                                                                                                       |
     * | `&lt;label&gt;`    | Name of the field in the Zuora user interface.                                                                                                                                                                                                                                               |
     * | `&lt;type&gt;`     | Data type of the field. The possible data types are: `boolean`, `date`, `datetime`, `decimal`, `integer`, `picklist`, `text`, `timestamp`, and `ZOQL`. If the data type is `picklist`, the `&lt;field&gt;` element contains an `&lt;options&gt;` element that lists the possible values of the field.    |
     * | `&lt;contexts&gt;` | Specifies the availability of the field. If the `&lt;contexts&gt;` element lists the `export` context, the field is available for use in data source exports.                                                                                                                                                |
     * 
     * The `&lt;field&gt;` element contains other elements that provide legacy information about the field. This information is not directly related to the REST API.
     * 
     * Response sample:
     * ```xml
     * &lt;?xml version="1.0" encoding="UTF-8"?&gt;
     * &lt;object&gt;
     *   &lt;name&gt;ProductRatePlanCharge&lt;/name&gt;
     *   &lt;label&gt;Product Rate Plan Charge&lt;/label&gt;
     *   &lt;fields&gt;
     *     ...
     *     &lt;field&gt;
     *       &lt;name&gt;TaxMode&lt;/name&gt;
     *       &lt;label&gt;Tax Mode&lt;/label&gt;
     *       &lt;type&gt;picklist&lt;/type&gt;
     *       &lt;options&gt;
     *         &lt;option&gt;TaxExclusive&lt;/option&gt;
     *         &lt;option&gt;TaxInclusive&lt;/option&gt;
     *       &lt;/options&gt;
     *       &lt;contexts&gt;
     *         &lt;context&gt;export&lt;/context&gt;
     *       &lt;/contexts&gt;
     *       ...
     *     &lt;/field&gt;
     *     ...
     *   &lt;/fields&gt;
     * &lt;/object&gt;
     * ```
     * 
     * It is strongly recommended that your integration checks `&lt;contexts&gt;` elements in the response. If your integration does not check `&lt;contexts&gt;` elements, your integration may process fields that are not available for use in data source exports. See [Changes to the Describe API](https://knowledgecenter.zuora.com/DC_Developers/M_Export_ZOQL/Changes_to_the_Describe_API) for more information.
     * 
     * @param request the request object containing all of the parameters for the API call
     * @return the response from the API call
     * @throws Exception if the API call fails
     */
    public org.openapis.openapi.models.operations.GETDescribeResponse getDescribe(org.openapis.openapi.models.operations.GETDescribeRequest request) throws Exception {
        String baseUrl = this._serverUrl;
        String url = org.openapis.openapi.utils.Utils.generateURL(org.openapis.openapi.models.operations.GETDescribeRequest.class, baseUrl, "/v1/describe/{object}", request, null);
        
        HTTPRequest req = new HTTPRequest();
        req.setMethod("GET");
        req.setURL(url);
        
        java.util.Map<String, java.util.List<String>> headers = org.openapis.openapi.utils.Utils.getHeaders(request);
        if (headers != null) {
            for (java.util.Map.Entry<String, java.util.List<String>> header : headers.entrySet()) {
                for (String value : header.getValue()) {
                    req.addHeader(header.getKey(), value);
                }
            }
        }
        
        HTTPClient client = this._defaultClient;
        HttpResponse<byte[]> httpRes = client.send(req);

        String contentType = httpRes.headers().firstValue("Content-Type").orElse("application/octet-stream");

        org.openapis.openapi.models.operations.GETDescribeResponse res = new org.openapis.openapi.models.operations.GETDescribeResponse() {{
            getDescribe200TextXMLString = null;
            getDescribe404TextXMLString = null;
        }};
        res.statusCode = httpRes.statusCode();
        res.contentType = contentType;
        res.rawResponse = httpRes;
        
        if (httpRes.statusCode() == 200) {
            res.headers = httpRes.headers().map().keySet().stream().collect(Collectors.toMap(Function.identity(), k -> httpRes.headers().allValues(k).toArray(new String[0])));
            
            if (org.openapis.openapi.utils.Utils.matchContentType(contentType, "text/xml; charset=utf-8")) {
                String out = new String(httpRes.body(), StandardCharsets.UTF_8);
                res.getDescribe200TextXMLString = out;
            }
        }
        else if (httpRes.statusCode() == 404) {
            res.headers = httpRes.headers().map().keySet().stream().collect(Collectors.toMap(Function.identity(), k -> httpRes.headers().allValues(k).toArray(new String[0])));
            
            if (org.openapis.openapi.utils.Utils.matchContentType(contentType, "text/xml; charset=utf-8")) {
                String out = new String(httpRes.body(), StandardCharsets.UTF_8);
                res.getDescribe404TextXMLString = out;
            }
        }

        return res;
    }
}