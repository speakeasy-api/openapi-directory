"""Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT."""

import requests as requests_http
from . import utils
from sdk.models import operations, shared
from typing import Optional

class Shipments:
    r"""Shipments are at the center of the ShipEngine API.  A shipment is the first step in [creating a shipping label](https://www.shipengine.com/docs/labels/create-a-label/), or [creating a manifest](https://www.shipengine.com/docs/shipping/manifests/).  It's also essential for [getting shipping rates](https://www.shipengine.com/docs/rates/).
    https://www.shipengine.com/docs/shipping/create-a-shipment/ - Learn about the shipment object model concept, and how to persist and re-use shipment data inside ShipEngine.
    """
    _client: requests_http.Session
    _security_client: requests_http.Session
    _server_url: str
    _language: str
    _sdk_version: str
    _gen_version: str

    def __init__(self, client: requests_http.Session, security_client: requests_http.Session, server_url: str, language: str, sdk_version: str, gen_version: str) -> None:
        self._client = client
        self._security_client = security_client
        self._server_url = server_url
        self._language = language
        self._sdk_version = sdk_version
        self._gen_version = gen_version
        
    def cancel_shipments(self, request: operations.CancelShipmentsRequest) -> operations.CancelShipmentsResponse:
        r"""Cancel a Shipment
        Mark a shipment cancelled, if it is no longer needed or being used by your organized. Any label associated with the shipment needs to be voided first
        An example use case would be if a batch label creation job is going to run at a set time and only queries `pending` shipments. Marking a shipment as cancelled
        would remove it from this process
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.CancelShipmentsRequest, base_url, '/v1/shipments/{shipment_id}/cancel', request)
        
        
        client = self._security_client
        
        http_res = client.request('PUT', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CancelShipmentsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 204:
            if utils.match_content_type(content_type, 'application/json'):
                res.empty_response_body = http_res.content
            if utils.match_content_type(content_type, 'text/plain'):
                res.empty_response_body = http_res.content
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def create_shipments(self, request: shared.CreateShipmentsRequestBodyInput) -> operations.CreateShipmentsResponse:
        r"""Create Shipments
        Create one or multiple shipments.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v1/shipments'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CreateShipmentsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.CreateShipmentsResponseBody])
                res.create_shipments_response_body = out
        elif http_res.status_code in [400, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def get_shipment_by_external_id(self, request: operations.GetShipmentByExternalIDRequest) -> operations.GetShipmentByExternalIDResponse:
        r"""Get Shipment By External ID
        Query Shipments created using your own custom ID convention using this endpint
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.GetShipmentByExternalIDRequest, base_url, '/v1/shipments/external_shipment_id/{external_shipment_id}', request)
        
        
        client = self._security_client
        
        http_res = client.request('GET', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.GetShipmentByExternalIDResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.GetShipmentByExternalIDResponseBody])
                res.get_shipment_by_external_id_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def get_shipment_by_id(self, request: operations.GetShipmentByIDRequest) -> operations.GetShipmentByIDResponse:
        r"""Get Shipment By ID
        Get an individual shipment based on its ID
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.GetShipmentByIDRequest, base_url, '/v1/shipments/{shipment_id}', request)
        
        
        client = self._security_client
        
        http_res = client.request('GET', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.GetShipmentByIDResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.GetShipmentByIDResponseBody])
                res.get_shipment_by_id_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def list_shipment_rates(self, request: operations.ListShipmentRatesRequest) -> operations.ListShipmentRatesResponse:
        r"""Get Shipment Rates
        Get Rates for the shipment information associated with the shipment ID
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.ListShipmentRatesRequest, base_url, '/v1/shipments/{shipment_id}/rates', request)
        
        query_params = utils.get_query_params(operations.ListShipmentRatesRequest, request)
        
        client = self._security_client
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ListShipmentRatesResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ListShipmentRatesResponseBody])
                res.list_shipment_rates_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def list_shipments(self, request: operations.ListShipmentsRequest) -> operations.ListShipmentsResponse:
        r"""List Shipments
        Get list of Shipments
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v1/shipments'
        
        query_params = utils.get_query_params(operations.ListShipmentsRequest, request)
        
        client = self._security_client
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ListShipmentsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ListShipmentsResponseBody])
                res.list_shipments_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def parse_shipment(self, request: shared.ParseShipmentRequestBodyInput) -> operations.ParseShipmentResponse:
        r"""Parse shipping info
        The shipment-recognition API makes it easy for you to extract shipping data from unstructured text, including people's names, addresses, package weights and dimensions, insurance and delivery requirements, and more.
        
        Data often enters your system as unstructured text (for example: emails, SMS messages, support tickets, or other documents). ShipEngine's shipment-recognition API helps you extract meaningful, structured data from this unstructured text. The parsed shipment data is returned in the same structure that's used for other ShipEngine APIs, so you can easily use the parsed data to create a shipping label.
        
        > **Note:** Shipment recognition is currently supported for the United States, Canada, Australia, New Zealand, the United Kingdom, and Ireland.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/v1/shipments/recognize'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('PUT', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ParseShipmentResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ParseShipmentResponseBody])
                res.parse_shipment_response_body = out
        elif http_res.status_code in [400, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def tag_shipment(self, request: operations.TagShipmentRequest) -> operations.TagShipmentResponse:
        r"""Add Tag to Shipment
        Add a tag to the shipment object
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.TagShipmentRequest, base_url, '/v1/shipments/{shipment_id}/tags/{tag_name}', request)
        
        
        client = self._security_client
        
        http_res = client.request('POST', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.TagShipmentResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.TagShipmentResponseBody])
                res.tag_shipment_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def untag_shipment(self, request: operations.UntagShipmentRequest) -> operations.UntagShipmentResponse:
        r"""Remove Tag from Shipment
        Remove an existing tag from the Shipment object
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.UntagShipmentRequest, base_url, '/v1/shipments/{shipment_id}/tags/{tag_name}', request)
        
        
        client = self._security_client
        
        http_res = client.request('DELETE', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.UntagShipmentResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 204:
            if utils.match_content_type(content_type, 'application/json'):
                res.empty_response_body = http_res.content
            if utils.match_content_type(content_type, 'text/plain'):
                res.empty_response_body = http_res.content
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    def update_shipment(self, request: operations.UpdateShipmentRequest) -> operations.UpdateShipmentResponse:
        r"""Update Shipment By ID
        Update a shipment object based on its ID
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.UpdateShipmentRequest, base_url, '/v1/shipments/{shipment_id}', request)
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "update_shipment_request_body_input", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = self._security_client
        
        http_res = client.request('PUT', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.UpdateShipmentResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.UpdateShipmentResponseBody])
                res.update_shipment_response_body = out
        elif http_res.status_code in [400, 404, 500]:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.ErrorResponseBody])
                res.error_response_body = out

        return res

    