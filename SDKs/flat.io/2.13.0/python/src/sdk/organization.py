"""Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT."""

import requests as requests_http
from . import utils
from sdk.models import operations, shared
from typing import Optional

class Organization:
    r"""Flat for Education organizations"""
    _client: requests_http.Session
    _security_client: requests_http.Session
    _server_url: str
    _language: str
    _sdk_version: str
    _gen_version: str

    def __init__(self, client: requests_http.Session, security_client: requests_http.Session, server_url: str, language: str, sdk_version: str, gen_version: str) -> None:
        self._client = client
        self._security_client = security_client
        self._server_url = server_url
        self._language = language
        self._sdk_version = sdk_version
        self._gen_version = gen_version
        
    def count_orga_users(self, request: operations.CountOrgaUsersRequest, security: operations.CountOrgaUsersSecurity) -> operations.CountOrgaUsersResponse:
        r"""Count the organization users using the provided filters"""
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/users/count'
        
        query_params = utils.get_query_params(operations.CountOrgaUsersRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CountOrgaUsersResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[int])
                res.count_orga_users_200_application_json_integer = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def create_lti_credentials(self, request: shared.LtiCredentialsCreation, security: operations.CreateLtiCredentialsSecurity) -> operations.CreateLtiCredentialsResponse:
        r"""Create a new couple of LTI 1.x credentials
        Flat for Education is a Certified LTI Provider. You can use these API methods to automate the creation of LTI credentials. You can read more about our LTI implementation, supported components and LTI Endpoints in our [Developer Documentation](https://flat.io/developers/docs/lti/).
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/lti/credentials'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CreateLtiCredentialsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.LtiCredentials])
                res.lti_credentials = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def create_organization_invitation(self, request: shared.OrganizationInvitationCreation, security: operations.CreateOrganizationInvitationSecurity) -> operations.CreateOrganizationInvitationResponse:
        r"""Create a new invitation to join the organization
        This method creates and sends invitation for teachers and admins.
        
        Invitations can only be used by new Flat users or users who are not part of the organization yet.
        
        If the email of the user is already associated to a user of your organization, the API will simply update the role of the existing user and won't send an invitation. In this case, the property `usedBy` will be directly filled with the uniquer identifier of the corresponding user.
        """
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/invitations'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CreateOrganizationInvitationResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.OrganizationInvitation])
                res.organization_invitation = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def create_organization_user(self, request: shared.UserCreation, security: operations.CreateOrganizationUserSecurity) -> operations.CreateOrganizationUserResponse:
        r"""Create a new user account"""
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/users'
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "request", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('POST', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.CreateOrganizationUserResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.UserDetailsAdmin])
                res.user_details_admin = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def list_lti_credentials(self) -> operations.ListLtiCredentialsResponse:
        r"""List LTI 1.x credentials"""
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/lti/credentials'
        
        
        client = self._client
        
        http_res = client.request('GET', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ListLtiCredentialsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[list[shared.LtiCredentials]])
                res.lti_credentials = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def list_organization_invitations(self, request: operations.ListOrganizationInvitationsRequest, security: operations.ListOrganizationInvitationsSecurity) -> operations.ListOrganizationInvitationsResponse:
        r"""List the organization invitations"""
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/invitations'
        
        query_params = utils.get_query_params(operations.ListOrganizationInvitationsRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ListOrganizationInvitationsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[list[shared.OrganizationInvitation]])
                res.organization_invitations = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def list_organization_users(self, request: operations.ListOrganizationUsersRequest, security: operations.ListOrganizationUsersSecurity) -> operations.ListOrganizationUsersResponse:
        r"""List the organization users"""
        base_url = self._server_url
        
        url = base_url.removesuffix('/') + '/organizations/users'
        
        query_params = utils.get_query_params(operations.ListOrganizationUsersRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('GET', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.ListOrganizationUsersResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[list[shared.UserDetailsAdmin]])
                res.user_details_admins = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def remove_organization_invitation(self, request: operations.RemoveOrganizationInvitationRequest, security: operations.RemoveOrganizationInvitationSecurity) -> operations.RemoveOrganizationInvitationResponse:
        r"""Remove an organization invitation"""
        base_url = self._server_url
        
        url = utils.generate_url(operations.RemoveOrganizationInvitationRequest, base_url, '/organizations/invitations/{invitation}', request)
        
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('DELETE', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RemoveOrganizationInvitationResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 204:
            pass
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def remove_organization_user(self, request: operations.RemoveOrganizationUserRequest, security: operations.RemoveOrganizationUserSecurity) -> operations.RemoveOrganizationUserResponse:
        r"""Remove an account from Flat
        This operation removes an account from Flat and its data, including:
        * The music scores created by this user (documents, history, comments, collaboration information)
        * Education related data (assignments and classroom information)
        """
        base_url = self._server_url
        
        url = utils.generate_url(operations.RemoveOrganizationUserRequest, base_url, '/organizations/users/{user}', request)
        
        query_params = utils.get_query_params(operations.RemoveOrganizationUserRequest, request)
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('DELETE', url, params=query_params)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RemoveOrganizationUserResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 204:
            pass
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def revoke_lti_credentials(self, request: operations.RevokeLtiCredentialsRequest, security: operations.RevokeLtiCredentialsSecurity) -> operations.RevokeLtiCredentialsResponse:
        r"""Revoke LTI 1.x credentials"""
        base_url = self._server_url
        
        url = utils.generate_url(operations.RevokeLtiCredentialsRequest, base_url, '/organizations/lti/credentials/{credentials}', request)
        
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('DELETE', url)
        content_type = http_res.headers.get('Content-Type')

        res = operations.RevokeLtiCredentialsResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 204:
            pass
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    def update_organization_user(self, request: operations.UpdateOrganizationUserRequest, security: operations.UpdateOrganizationUserSecurity) -> operations.UpdateOrganizationUserResponse:
        r"""Update account information"""
        base_url = self._server_url
        
        url = utils.generate_url(operations.UpdateOrganizationUserRequest, base_url, '/organizations/users/{user}', request)
        
        headers = {}
        req_content_type, data, form = utils.serialize_request_body(request, "user_admin_update", 'json')
        if req_content_type not in ('multipart/form-data', 'multipart/mixed'):
            headers['content-type'] = req_content_type
        if data is None and form is None:
            raise Exception('request body is required')
        
        client = utils.configure_security_client(self._client, security)
        
        http_res = client.request('PUT', url, data=data, files=form, headers=headers)
        content_type = http_res.headers.get('Content-Type')

        res = operations.UpdateOrganizationUserResponse(status_code=http_res.status_code, content_type=content_type, raw_response=http_res)
        
        if http_res.status_code == 200:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.UserDetailsAdmin])
                res.user_details_admin = out
        else:
            if utils.match_content_type(content_type, 'application/json'):
                out = utils.unmarshal_json(http_res.text, Optional[shared.FlatErrorResponse])
                res.flat_error_response = out

        return res

    